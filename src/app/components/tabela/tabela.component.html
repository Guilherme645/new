<!-- Main Container with Table -->
<div class="flex flex-row items-start w-full h-[calc(100vh-200px)] bg-white border border-gray-100 rounded-lg overflow-y-auto overflow-x-hidden box-border">
  <div class="flex flex-col w-full mx-auto">
    <table class="w-full border-collapse bg-white relative">

      <thead class="sticky top-0 bg-white z-10 border-b border-gray-200">
        <tr>
          <th class="w-[91px] p-2 text-center align-middle">
            <div class="h-[26px]"></div>
          </th>
          <th class="p-2 align-middle max-w-[300px] break-words" (click)="sortBy('name')">
            <div class="flex items-center gap-1 text-xs font-semibold text-gray-600 cursor-pointer">
              {{ type === 'project' ? 'NOME DO PROJETO' : 'NOME DA COLEÇÃO' }}
              <div class="ml-[149px]">
                <div class="relative group flex items-center justify-center w-8 h-8">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    class="cursor-pointer"
                  >
                    <path
                      d="M7.33301 10.6666L5.33301 12.6666M5.33301 12.6666L3.33301 10.6666M5.33301 12.6666V3.33325M8.66634 5.33325L10.6663 3.33325M10.6663 3.33325L12.6663 5.33325M10.6663 3.33325V12.6666"
                      stroke="#535862"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <div class="absolute top-0 left-[-10px] -translate-x-1/2 mt-8 opacity-0 group-hover:opacity-100 transition-opacity">
                    <app-tooltip text="Ordenação"></app-tooltip>
                  </div>
                </div>
              </div>
            </div>
          </th>
          <th class="p-2 align-middle max-w-[300px] break-words" (click)="sortBy('description')">
            <div class="flex items-center gap-1 text-xs font-semibold text-gray-600 cursor-pointer">
              DESCRIÇÃO
              <div class="ml-[232px]">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="cursor-pointer"
                >
                  <path
                    d="M7.33301 10.6666L5.33301 12.6666M5.33301 12.6666L3.33301 10.6666M5.33301 12.6666V3.33325M8.66634 5.33325L10.6663 3.33325M10.6663 3.33325L12.6663 5.33325M10.6663 3.33325V12.6666"
                    stroke="#535862"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </div>
            </div>
          </th>
          <th class="p-2 align-middle max-w-[401px] break-words">
            <div class="flex items-center gap-1 mr-[52px] text-xs font-semibold text-gray-600 cursor-pointer">
              INDEXAÇÃO
              <div class="ml-[205px]">
                <app-dropdown></app-dropdown>
              </div>
            </div>
          </th>
          <th class="w-[47px] p-0 text-center align-middle"></th>
        </tr>
      </thead>
      <tbody class="relative">
        <ng-container *ngFor="let item of data; let i = index">
          <tr>
            <td class="p-2 text-center align-middle">
              <div *ngIf="type === 'project'" class="flex items-center gap-2 justify-center cursor-pointer" (click)="toggleItem(i)">
                <svg
                  class="shrink-0 transition-transform duration-200"
                  [ngClass]="{ 'rotate-90': item.expanded }"
                  width="10"
                  height="6"
                  viewBox="0 0 10 6"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M9 1L5 5L1 1" stroke="#717680" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="relative group inline-block">
                  <svg
                    class="shrink-0 cursor-pointer"
                    width="34"
                    height="26"
                    viewBox="0 0 34 26"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M33 7.5V23C33 24.1046 32.1046 25 31 25H3C1.89543 25 1 24.1046 1 23V3C1 1.89543 1.89543 1 3 1H11.1817C11.7062 1 12.2096 1.20597 12.5836 1.57354L15.9953 4.92646C16.3694 5.29403 16.8728 5.5 17.3972 5.5H31C32.1046 5.5 33 6.39543 33 7.5Z"
                      fill="#D6DBF7"
                      stroke="#ADB7F0"
                      stroke-width="0.8"
                    />
                  </svg>
                  <div class="absolute top-0 left-[52px] -translate-x-1/2 mt-8 opacity-0 group-hover:opacity-100 transition-opacity">
                    <app-tooltip text="Ver coleções do projeto"></app-tooltip>
                  </div>
                </div>
              </div>
              <div *ngIf="type === 'collection'" class="w-[34px] h-[26px]"></div>
            </td>
            <td class="p-2 align-middle max-w-[300px] break-words">
              <div class="text-sm text-gray-900 py-2">{{ item.name || item.title }}</div>
            </td>
            <td class="p-2 align-middle max-w-[300px] break-words">
              <div class="text-sm text-gray-900 py-2">{{ item.description }}</div>
            </td>
            <td class="p-2 align-middle max-w-[401px] break-words">
              <app-progress-bar [state]="item.progressState" [percent]="item.progressPercent"></app-progress-bar>
            </td>
            <td class="p-0 text-center align-middle relative">
              <div class="inline-block group">
                <button (click)="toggleDropdown(i)" class="h-[26px] mt-5 cursor-pointer">
                  <svg width="16" height="4" viewBox="0 0 16 4" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M13 2C13 2.55228 13.4477 3 14 3C14.5523 3 15 2.55228 15 2C15 1.44772 14.5523 1 14 1C13.4477 1 13 1.44772 13 2Z"
                      stroke="#717680"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 2C7 2.55228 7.44772 3 8 3C8.55228 3 9 2.55228 9 2C9 1.44772 8.55228 1 8 1C7.44772 1 7 1.44772 7 2Z"
                      stroke="#717680"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M1 2C1 2.55228 1.44772 3 2 3C2.55228 3 3 2.55228 3 2C3 1.44772 2.55228 1 2 1C1.44772 1 1 1.44772 1 2Z"
                      stroke="#717680"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <div
                  class="absolute bottom-full left-[-15px] -translate-x-1/2 mb-1 opacity-0 group-hover:opacity-100 transition-opacity z-50"
                >
                  <app-tooltip text="Mais opções"></app-tooltip>
                </div>
                <app-option-dropdown
                  *ngIf="dropdownIndex === i"
                  class="absolute mt-2 z-[9999] bg-white shadow-lg rounded-md min-w-[180px]"
                  (edit)="handleEdit()"
                  (duplicate)="handleDuplicate()"
                  (remove)="handleRemove()"
                    (openRemove)="emitOpenRemove()"
                ></app-option-dropdown>
              </div>
            </td>
          </tr>
          <tr *ngIf="item.expanded && type === 'project'" class="bg-gray-50">
            <td colspan="5" class="p-0">
              <div class="block w-full h-auto box-border overflow-hidden">
                <div class="overflow-x-hidden">
                  <app-collection-tree [data]="item.subcollections || []"></app-collection-tree>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>

<!-- Pagination aligned below the table (not fixed) -->
<div class="mt-4 px-4 flex justify-between items-center ml-1 w-full max-w-[1256px] mx-auto bg-white border-t border-gray-100 py-2">
  <div class="text-sm text-gray-600">
    Exibindo {{ data.length }} de {{ totalItems }} {{ type === 'project' ? 'projetos' : 'coleções' }}
  </div>
  <div class="flex items-center gap-2">
    <ng-container *ngIf="currentPage > 1; else leftSpacer">
      <button aria-label="Página anterior" class="p-1 bg-none border-none cursor-pointer" (click)="previousPage()">
        <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
          <path d="M9.33333 11.6271L6.66666 8.96043L9.33333 6.29376" stroke="black" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </ng-container>
    <ng-template #leftSpacer>
      <div class="w-4 h-[17px]"></div>
    </ng-template>

    <div class="flex items-center gap-1">
      <div class="border border-gray-300 rounded-md px-2 py-1">
        <div class="text-sm text-gray-900">{{ currentPage }}</div>
      </div>
      <span class="text-sm text-gray-600">de {{ totalPages }} páginas</span>
    </div>

    <ng-container *ngIf="currentPage < totalPages; else rightSpacer">
      <button aria-label="Próxima página" class="p-1 bg-none border-none cursor-pointer" (click)="nextPage()">
        <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
          <path d="M6.66667 6.29376L9.33334 8.96043L6.66667 11.6271" stroke="black" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </ng-container>
    <ng-template #rightSpacer>
      <div class="w-4 h-[17px]"></div>
    </ng-template>
  </div>
</div>